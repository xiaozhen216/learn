<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>分拨操作货量</title>

	<script type="text/javascript" src="../framework/core.js"></script>
	<script type="text/javascript" src="../framework/ajax.js"></script>
	<script type="text/javascript" src="../ichartjs/ichart.1.1.min.js"></script>

	<script type="text/javascript">

	var serviceUrl = Query.get("service") || "../display/json/206";
	
	function query() {

		var selectedDate = $$("selectedDate").value;

		Ajax({
			url : serviceUrl,
			method : "POST",
			params : {"param1": selectedDate,"param2": selectedDate}, //
			type : "json",
			waiting : true,
			ondata : function() {
				var data = eval(this.getResponseText());
				show(data);
			}
		});	  
	}



	function show(originData) {
		var total = 0;
		var dataw = [];
		var datao = [];
		var labels = [];
		var maxdata=0;
		var scaledata=0;
		var spacedata = 0;
		for(var i = 0; i < originData.length; i++) {

			var center = originData[i]["分拨"];
			var weight = originData[i]["货量"];
			var orders = originData[i]["票数"];	

			if (maxdata<orders) {
				maxdata=orders
			}
			scaledata=Math.ceil(maxdata/1000) * 1000;
			spacedata = scaledata/5;
			total += weight;
			dataw[i] = weight;
			datao[i] = orders;
			labels[i] = center;
		}
		
		//total = Math.round(total/1000);

		$(function() {
		    var data = [{
		        name: '操作货量',
		        value: dataw,
		        color: '#006400'
		    },
		    {
		        name: '操作票数',
		        value: datao,
		        color: '#FF6347'
		    }];
		    var chart = new iChart.ColumnMulti2D({
		        render: 'canvasDiv',
		        data: data,
		        labels: labels,
		        title: '百世快运各分拨操作货量',
		        subtitle: '总操作量: ' + total + ' T',
		        footnote: '该统计源为主单扫描',
		        width: 1900,
		        height: 800,
		        background_color: '#ffffff',
		        legend: {
		            enable: true,
		            background_color: null,
		            border: {
		                enable: false
		            }
		        },
		        coordinate: {
		            background_color: '#f1f1f1',
		            scale: [{
		                position: 'left',
		                start_scale: 0,
		                end_scale: scaledata,
		                scale_space: spacedata
		            }],
		            width: 1900,
		            height: 760
		        }
		    });
		    chart.draw();
		});

		}
	
	</script>
</head>

<body>
	
	<form method="get" target='hiddenFrame'>
		日期: <input type="date" name="selectedDate" id="selectedDate"/> &nbsp;
		<input type="submit" onclick="query()" value="查询"/>
	</form>
	<iframe width='0px' height='0px' name='hiddenFrame'></iframe>
	
	<div id='canvasDiv'></div>

</body>
</html>