<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>装载率报表</title>

	<script type="text/javascript" src="../framework/core.js"></script>
	<script type="text/javascript" src="../framework/ajax.js"></script>
	<script type="text/javascript" src="../ichartjs/ichart.1.1.min.js"></script>

<style>
	#searchDiv {
		margin-left:10px;
		margin-top:20px;
		font-size:15px;
	}

	#searchDiv input {
		color:#535458;
		height:18px;
		border:1px solid #ABAAAF;
		background-color:#ECEFF8;
	} 
	#searchDiv select{
		font-size:12px;
		height:18px;
		border:1px solid #ABAAAF;
		background-color:#ECEFF8;
	}

</style>

<script type="text/javascript">
	
	window.onload = function() {
		Ajax({
			url : "../display/json/189",
			method : "GET",
			type : "json",
			ondata : function() {
				var result = eval(this.getResponseText()); 
				if( result == null ) {	 
					return;
				}				
				for(var i = 0; i < result.length; i++) {
					var optionValue = result[i].province + "_" + result[i].city;
					var option1 = new Option(optionValue, result[i].city);
					$$("fromCity").options.add(option1);  
				}

				for(var i = result.length - 1; i >= 0; i--) {
					var optionValue = result[i].province + "_" + result[i].city;
					var option2 = new Option(optionValue, result[i].city);
					$$("toCity").options.add(option2); 
				}
			}
		});
	}
	
	function query() {
		var fromCity = $$("fromCity").value;
		var toCity = $$("toCity").value;
		Ajax({
			url : "../display/json/187",
			params: {"param1": fromCity, "param2": toCity},
			method : "POST",
			type : "json",
			waiting : true,
			ondata : function() {
				var data = eval(this.getResponseText());
				show(data);
			}
		});	  
	}

	function show(data) {
		var total = 100;
		var szList = [0];
		var ezList = [0];
		var rtList = [0];
		var labels = ["没有数据"];
		for(var i = 0; i < data.length; i++) {
			szList[i] = Math.round(data[i]["实重"]);
			ezList[i] = Math.round(data[i]["额重"]);
			rtList[i] = Math.round(data[i]["装载率"] * 100);
			labels[i] = data[i]["日期"];
			total = Math.max(total, szList[i]);
			total = Math.max(total, ezList[i]);

			if(i > 11) break;
		}
		total = Math.round(total/1000) * 1000 * 2;

		$(function(){
			var data = [
			        	{
			        		name : '百分比',
			        		value:rtList,
			        		color:'#1f7e92',
			        		line_width:3
			        	}
			       ];
			var chart = new iChart.LineBasic2D({
						render : 'canvasDiv2',
						data: data,
						title: '装载率统计（百分比）',
						width: 1300,
						height: 300,
						coordinate:{height:'95%', background_color:'#f6f9fa'},
						sub_option:{
							hollow_inside:false, // 设置一个点的亮色在外环的效果
							point_size: 16
						},
						labels:labels
					});
			chart.draw();
		});
				
				
	    $(function(){
			var data = [
				{
					name : '实重',
					value:szList,
					color:'#1385a5'
				},
				{
					name : '额重',
					value:ezList,
					color:'#c56966'
				}
			 ];

			var chart = new iChart.ColumnMulti2D({
					render : 'canvasDiv',
					data: data,
					labels:labels,
					title : '装载率统计（单位:吨）',
					width: 1300,
					height: 300,
					background_color : '#ffffff',
					legend:{
						enable:true,
						background_color : 'yellow',
						border : {
							enable : false
						}
					},
					coordinate:{
						background_color : '#f1f1f1',
						width: '100%',
						scale:[{
							 position:'left',	
							 start_scale:0,
							 end_scale: total,
							 scale_space: total / 5
						}],
					}
			});
			chart.draw();
		});
	}
	
	</script>
</head>

<body>

<div id="searchDiv">
	<form method="get" target='hiddenFrame'>
		路线从: <select id="fromCity"></select> 到:  <select id="toCity"></select> &nbsp;&nbsp;&nbsp;
		日期从: <input type="date" name="fromDate"/>  到:  <input type="date" name="toDate"/>&nbsp;
		统计方式: <select id="dataType">
			<option value="1" selected>按月</option>
			<option value="2">按周</option>
			<option value="3">按天</option>
		</select>&nbsp;
		<input type="submit" onclick="query()" value="查询"/>
	</form>
	<iframe width='0px' height='0px' name='hiddenFrame'></iframe>
</div>

	<div id='canvasDiv'></div>
	<div id='canvasDiv2'></div>
	
</body>
</html>