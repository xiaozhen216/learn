<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<title>各省份货量</title>

	<script type="text/javascript" src="../framework/core.js"></script>
	<script type="text/javascript" src="../framework/ajax.js"></script>
	<script type="text/javascript" src="../ichartjs/ichart.1.1.min.js"></script>

	<script type="text/javascript">

	var serviceUrlTransQ = Query.get("service") || "../display/json/193";
	
	function queryTransQ() {
		var selectedDate = $$("selectedDate").value;
		Ajax({
			url : serviceUrlTransQ,
			method : "GET",
			params : {"param1": selectedDate}, 
			type : "json",
			waiting : true,
			ondata : function() {
				var data = eval(this.getResponseText());
				showTransQ(data);
			}
		});	  
	}

	var COLORS = ['red', 'green', '#f76864', 'yellow', 'blue', '#555555', '#4444444'];

	function showTransQ(originData) {
		var total = 0;
		var data = [];
		for(var i = 0; i < originData.length; i++) {
			var weight = originData[i]["重量"];
			var province = originData[i]["省份"];

			total += weight;
			data[i] = {name: province, value: weight, color: COLORS[i] };
		}
				
	    $(function(){
				var chart = new iChart.Donut2D({
					render : 'canvasDivTransQ',
					data: data,
					title : {
						text : '各省货量分布',
						color : '#3e576f'
					},
					footnote : {
						text : '单位：T',
						color : '#486c8f',
						fontsize : 20,
						padding : '0 38'
					},
					center : {
						text:'总量:' + total,
						color:'#3e576f',
						shadow:true,
						shadow_blur : 0,
						shadow_color : '#557797',
						shadow_offsetx : 0,
						shadow_offsety : 0,
						fontsize : 40
					},
					sub_option : {
						label : {
							background_color:null,
							sign:false,//设置禁用label的小图标
							padding:'0 3',
							border:{
								enable:false,
								color:'#666666'
							},
							fontsize:20,
							fontweight:600,
							color : '#4572a7'
						},
						border : {
							width : 2,
							color : '#ffffff'
						}
					},
					shadow : false,
					shadow_blur : 0,
					shadow_color : '#aaaaaa',
					shadow_offsetx : 0,
					shadow_offsety : 0,
					background_color:'#FFF8DC',
					offset_angle:-120,//逆时针偏移120度
					showpercent:false,
					decimalsnum:2,
					width : 1700,
					height : 600,
					radius:200
				});
				
				chart.draw();
			});
	}
	

	var serviceUrlIncome = Query.get("service") || "../display/json/196";
	
	function queryIncome() {
		var selectedDate = $$("selectedDate").value;
		Ajax({
			url : serviceUrlIncome,
			method : "GET",
			params : {"param1": selectedDate}, 
			type : "json",
			waiting : true,
			ondata : function() {
				var data = eval(this.getResponseText());
				showIncome(data);
			}
		});	  
	}

	
	function showIncome(originData) {
		var total = 0;
		var dataOne = [];
		var dataTwo = [];
		var dataP = [];
		var maxdata = 0;
		var scaledata = 0;
		var cellData = 0;
		for(var i = 0; i < originData.length; i++) {
			var incomeTrans = originData[i]["incomeTrans"];
			var incomeStock = originData[i]["incomeStock"];
			var province = originData[i]["province"];
			if (maxdata<(incomeTrans+incomeStock)) {
				maxdata=(incomeTrans+incomeStock)
			}
			scaledata=Math.floor(maxdata/100000) * 100000 + 100000;

			total += incomeTrans+incomeStock;
			dataOne[i] = Math.round(incomeTrans);
			dataTwo[i] = incomeStock;
			dataP[i] = province;
		}
			total = Math.round(total);
			cellData = scaledata/5

		$(function(){
			var data = [
			{
				name : '中转收入',
				value:dataOne,
				color:'#32bdbc'
			},
			{
			name : '物料收入',
				value:dataTwo,
				color:'#d75a5e'
			}
			];
			var chart = new iChart.ColumnStacked2D({
				render : 'canvasDivIncome',
				data: data,
				labels:dataP,
				title : {
					text:'快运事业部中转费收入及物料收入',
					color:'#dcd6cb',
					textAlign:'left',
					padding:'0 40',
					font:'微软雅黑',
					border:{
					enable:true,
					width:[0,0,4,0],
					color:'#698389'
				},
				height:40
				},
				footnote : {
					text:'当日总收入：￥' + total,
					font:'微软雅黑',
					padding:'0 8',
					color:'#dcd6cb'
				},
				padding:'8 0',
				width : 800,
				height : 400,
				column_width:70,
				gradient : true,//应用背景渐变
				gradient_mode:'LinearGradientDownUp',//渐变类型
				color_factor : 0.1,//渐变因子
				background_color : '#425154',
				sub_option:{
					label:{color:'#f9f9f9',fontsize:12,fontweight:600},
					border : false
				},
				label:{color:'#dcd6cb',font:'微软雅黑',fontsize:12,fontweight:600},
				legend:{
					enable:true,
					background_color : null,
					line_height:25,
					color:'#dcd6cb',
					fontsize:12,
					font:'微软雅黑',
					fontweight:600,
					border : {
						enable : false
					}
				},
				column_width:80,
				coordinate:{
					background_color : 0,
					grid_color:'#888888',
					axis : {
						color : '#c0d0e0',
						width : 0
					},
					scale:[{
						position:'left',
						scale_enable : false,
						start_scale:0,
						scale_space:cellData,
						end_scale:scaledata,
						label:{color:'#dcd6cb',fontsize:11,fontweight:600}
					}],
					width:'92%',
					height:'88%'
				}
				});
				//利用自定义组件构造左上侧单位
				chart.plugin(new iChart.Custom({
				drawFn:function(){
					//计算位置
					var coo = chart.getCoordinate(),
					x = coo.get('originx'),
					y = coo.get('originy');
					//在左上侧的位置，渲染一个单位的文字
					chart.target.textAlign('end')
					.textBaseline('bottom')
					.textFont('600 12px 微软雅黑')
					.fillText('单位(元)',x,y-14,false,'#be5863')
					}
				}));
				chart.draw();
			}); 

		}


	</script>
	<style type="text/css">
	#canvasDivTransQ{
		margin-left: 10px;
	}

	#canvasDivIncome{
		margin-top: 20px;
		margin-left: 0px;
	}

	</style>


</head>

<body>
	
	<form method="get" target='hiddenFrame'>
		日期: <input type="date" name="selectedDate" id="selectedDate"/> &nbsp;
		<input type="submit" onclick="queryTransQ();queryIncome()" value="查询"/>
	</form>
	<iframe width='0px' height='0px' name='hiddenFrame'></iframe>
	
	<div id='canvasDivTransQ'></div>	
	<div id='canvasDivIncome'></div>

</body>
</html>